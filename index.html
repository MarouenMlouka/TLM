<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TLM connecting people</title>
    <!-- Intégrer les CDN nécessaires, comme Firebase et tout autre bibliothèque JavaScript -->
    <!-- Exemple de CDN pour Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.1/firebase-database.js"></script>
    <!-- Intégrer d'autres bibliothèques JavaScript si nécessaire -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Bibliothèque pour les graphiques -->
    <style>
        /* Styles CSS pour la mise en forme */
        .group-container {
            margin-bottom: 20px;
        }
        .group-buttons {
            margin-top: 10px;
        }
        .group-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        .group-table th, .group-table td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }
        .points-diagram {
            margin-top: 20px;
        }
        .reset-button {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="welcome-message">
        <h1>BIENVENUE to TLM connecting people platform</h1>
    </div>

    <div id="groups-container">
        <!-- Générer dynamiquement les groupes -->
    </div>

    <div class="points-diagram" id="points-diagram">
        <!-- Diagramme de suivi des points -->
        <h2>Points Tracking Diagram</h2>
        <canvas id="points-chart"></canvas>
    </div>

    <div class="reset-button">
        <!-- Bouton pour réinitialiser tous les points -->
        <h2>Reset All Points</h2>
        <button onclick="resetAllPoints()">Reset Points</button>
    </div>

    <!-- Script JavaScript pour interagir avec Firebase et gérer les actions -->
    <script>
        // Initialiser Firebase avec vos informations de configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB5ylD0VICzYIcBEGEDduYotndKz5NrAIY",
            authDomain: "tlm2020.firebaseapp.com",
            projectId: "tlm2020",
            storageBucket: "tlm2020.appspot.com",
            messagingSenderId: "214565744764",
            appId: "1:214565744764:web:cc17d2df87206106af19f9",
            measurementId: "G-9RJK2B6S3S"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Fonction pour ajouter des points à un groupe
        function addPoints(group) {
            const keyword = prompt("Please enter the keyword 'TLM' to confirm adding points:");
            if (keyword === 'TLM') {
                const pointsRef = database.ref(`groups/${group}/points`);
                pointsRef.transaction(function(currentPoints) {
                    return (currentPoints || 0) + 10; // Ajouter 10 points
                });

                // Mettre à jour le diagramme de suivi des points
                updatePointsDiagram();
            } else {
                alert("Invalid keyword. Points not added.");
            }
        }

        // Fonction pour modifier les points d'un groupe
        function modifyPoints(group) {
            const keyword = prompt("Please enter the admin keyword to modify points:");
            if (keyword === 'admin') {
                const newPoints = prompt(`Enter new points for ${group}:`);
                const pointsRef = database.ref(`groups/${group}/points`);
                pointsRef.set(parseInt(newPoints));

                // Mettre à jour le diagramme de suivi des points
                updatePointsDiagram();
            } else {
                alert("Unauthorized access. Points not modified.");
            }
        }

        // Fonction pour réinitialiser tous les points
        function resetAllPoints() {
            const keyword = prompt("To reset all points, please enter the confirmation keyword '1925':");
            if (keyword === '1925') {
                // Réinitialiser tous les points dans Firebase
                const groupsRef = database.ref('groups');
                groupsRef.once('value', function(snapshot) {
                    snapshot.forEach(function(childSnapshot) {
                        const childKey = childSnapshot.key;
                        const pointsRef = database.ref(`groups/${childKey}/points`);
                        pointsRef.set(0);
                    });
                });

                // Mettre à jour le diagramme de suivi des points
                updatePointsDiagram();
            } else {
                alert("Incorrect keyword. Points not reset.");
            }
        }

        // Fonction pour mettre à jour le diagramme de suivi des points
        function updatePointsDiagram() {
            const groupsRef = database.ref('groups');
            groupsRef.once('value', function(snapshot) {
                const groupsContainer = document.getElementById('groups-container');
                let groupsHTML = '';
                snapshot.forEach(function(childSnapshot) {
                    const groupKey = childSnapshot.key;
                    const pointsValue = childSnapshot.val().points || 0;
                    groupsHTML += `
                        <div class="group-container">
                            <h2>${groupKey}</h2>
                            <div class="group-buttons">
                                <button onclick="addPoints('${groupKey}')">Add Points</button>
                                <input type="text" value="${pointsValue}" readonly>
                                <button onclick="modifyPoints('${groupKey}')">Modify Points</button>
                                <table class="group-table">
                                    <thead>
                                        <tr>
                                            <th>Details</th>
                                        </tr>
                                    </thead>
                                    <tbody id="${groupKey}-details-body">
                                        <!-- Les détails du groupe ${groupKey} seront ajoutés ici dynamiquement -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                });
                groupsContainer.innerHTML = groupsHTML;

                // Afficher le diagramme de suivi des points avec Chart.js
                const points = [];
                snapshot.forEach(function(childSnapshot) {
                    const pointsValue = childSnapshot.val().points || 0;
                    points.push(pointsValue);
                });
                const ctx = document.getElementById('points-chart').getContext('2d');
                const myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: Array.from(snapshot.val(), (val, key) => key),
                        datasets: [{
                            label: 'Points',
                            data: points,
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            });
        }

        // Chargement initial des groupes et du diagramme de points
        window.onload = function() {
            updatePointsDiagram();
        };
    </script>
</body>
</html>
